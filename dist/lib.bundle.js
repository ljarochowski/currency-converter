!function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4)}([function(e,t){const i="__converted_currency_highlight",r="__converted_currency_popup";class s{constructor(e,t){let s;if(e instanceof HTMLElement?s=e:((s=document.createElement("span")).setAttribute("class",i),s.innerText=e),0===s.getElementsByClassName(r).length){let e=new n(t);s.appendChild(e.toDOMElement())}this.element=s}activate(){let e=Array.from(this.element.getElementsByClassName(r)),t=new n(e.pop());this.element.addEventListener("mouseover",t.toggle.bind(t)),this.element.addEventListener("mouseout",t.toggle.bind(t)),this.element.addEventListener("mousemove",e=>{t.moveTo(e.layerX,e.layerY)})}toDOMElement(){return this.element}toString(){return this.element.outerHTML}}class n{constructor(e){this.boxStyles={display:"none",position:"absolute","z-index":"100000",background:"white",border:"1px solid #ddd","border-radius":"5px","box-shadow":"3px 3px #ddd",padding:"10px"},e instanceof HTMLElement?this.element=e:(e=`${e}`,this.element=document.createElement("div"),this.element.setAttribute("class",r),this.element.setAttribute("style",this.getStyle(this.boxStyles)),this.element.innerText=e.replace(".",",")+" PLN")}getStyle(e){let t="";for(let i in e)i in e&&(t+=`${i}:${e[i]};`);return t}updateStyles(e){this.element.setAttribute("style",this.getStyle(e))}toggle(){let e=this.boxStyles;e.display="block"===e.display?"none":"block",this.updateStyles(e)}moveTo(e,t){let i=this.boxStyles;i.top=`${t}px`,i.left=`${e}px`,this.updateStyles(i)}toDOMElement(){return this.element}}e.exports=class{constructor(e){e instanceof HTMLElement?(this.node=e,this.compiled=this.node.innerHTML):this.compiled=`${e}`}async highlight(e){const t=/([€£$])((?:\d+[ .,]?)+(?:[.,](?:\d{2}))?)\b/g;let r,s,n,o,c=new Map;for(;r=t.exec(this.node.innerHTML);){[s,n,o]=r;let t=await e.call({},o,n);c.set(s,t)}for(let[e,t]of c){let r,s=document.evaluate('//text()[contains(., "'+e+'")]',this.node,null,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),n=[];for(;r=s.iterateNext();){let e=r.parentElement;e.getAttribute("class")!==i&&n.push(e)}n.forEach(i=>{i.innerHTML=i.innerHTML.replace(e,this.create(e,t))})}}save(){this.activateHighlightedElements(this.node)}toString(){return this.compiled}create(e,t){return new s(e,t)}activateHighlightedElements(e){let t=e.getElementsByClassName(i);for(let e of t)new s(e).activate()}}},function(e,t){e.exports=class{constructor(...e){if(e[0]instanceof Array?[...e]=e[0]:[...e]=e,0===e.length)throw Error("no currencies set");this.currencyISOnames={"€":"eur","£":"gbp",$:"usd","zł":"pln"},this.currencies=Array.from(e),this.currencies.push("pln"),this.currencies.map(this.getISOcode.bind(this)),this.forexURL="https://api.nbp.pl/api/exchangerates/rates/a",this.cacheTimeStamp=Date.now(),this.ttl=14400,this.exchange={}}getISOcode(e){return void 0!==this.currencyISOnames[e]?this.currencyISOnames[e]:e}async loadExchangeRates(e){if(e instanceof Object)return this.exchange=e,this.cacheTimeStamp=Date.now(),this;if(!this.hasFXexpired())return this;for(let e in this.currencies)if(e in this.currencies){let t=this.currencies[e];this.exchange[t]=await this.getRate(t)}return this.cacheTimeStamp=Date.now(),this}async convert(e,t,i){t=this.getISOcode(t),i=this.getISOcode(i);let r=await this.getConversionRate(t,i);return Math.round(100*e*r,2)/100}async getConversionRate(e,t){if(e=this.getISOcode(e).toLowerCase(),t=this.getISOcode(t).toLowerCase(),-1===this.currencies.indexOf(e)&&-1===this.currencies.indexOf(t))throw Error("no valid currency found, valid are: "+this.currencies);return"pln"===e?1/await this.getRate(t):await this.getRate(e)}async getRate(e){let t=1;if("pln"===e)return t;if(this.hasFXexpired()||void 0===this.exchange[e]){let i=`${this.forexURL}/${e}/`,r=await fetch(i);t=(await r.json()).rates.pop().mid}else t=this.exchange[e];return t}getRates(){return this.exchange}hasFXexpired(){return Date.now()-this.cacheTimeStamp<this.ttl}}},function(e,t){e.exports=class{constructor(){return(...e)=>{}}}},function(e,t){e.exports=class{constructor(){return(...e)=>{console.log(...e)}}}},function(e,t,i){let r=i(3),s=i(2),n=i(1),o=i(0);class c{constructor(e,t,i={}){this.options=i,this.currencies=e,this.rates=t,this.logger={},this.forexService={},this.highlighterService={}}async getLogger(){return this.logger instanceof r?this.logger:(!0===this.options.debug?this.logger=new r:this.logger=new s,this.logger)}async getForexService(){return this.forexService instanceof n?this.forexService:(this.forexService=new n(this.currencies),null!==this.rates&&await this.forexService.loadExchangeRates(this.rates),this.forexService)}async getHighlighterService(e){if(this.highlighterService instanceof o)return this.highlighterService;if(!(e instanceof HTMLElement))throw Error(`Highlighter Service has to be attached to a DOMElement,\n                ${typeof e} provided instead`);return this.highlighterService=new o(e),this.highlighterService}async serialize(){return Object.freeze({rates:(await this.getForexService()).getRates(),options:this.options,currencies:this.currencies})}static unserialize(e){return new c(e.currencies,e.rates,e.options)}}e.exports=c}]);